% $Id$
% XXX WOULD A SMALLER FONT BE BETTER?
\documentclass[a4paper,12pt,draft]{report}
\pagestyle{headings}

% Useful stuff for math mode.
\usepackage{amstext}
% Include images
\usepackage[final]{graphicx}
\usepackage{url}
% Add the bibliography into the table of contents.
\usepackage[chapter,numbib]{tocbibind}
% Create a label for the last page.  Might be useful for "page 23/79" or
% something.
\usepackage{lastpage}

% Extra footnote functionality, including references to earlier footnotes.
\usepackage[bottom]{footmisc}
% The Euro symbol
\usepackage{eurofont}

% Aligned list environments.
\usepackage{eqlist}

% Tell Latex to use scalable fonts
\usepackage{type1cm}

% Extra packages recommended by Springer.
%\usepackage{mathptmx}
%\usepackage{helvet}
%\usepackage{courier}
%\usepackage{makeidx}
%\usepackage{multicol}

% Embed SVN Id etc.
\usepackage{svn}

% Sort numbers where there are multiple citations.  Does not appear to have
% the expected effect (probably clashes with varioref or hyperref), though
% it does reduce the space between numbers.
\usepackage{cite}
% Check for unused references.
% \usepackage{refcheck}

\newcommand{\parserblurb}[3]{%
    \begin{quotation}
        \noindent{}\textit{#1\/}

        \noindent{}\url{#2}\newline
        Last checked #3.
    \end{quotation}
}

% Produce nicer references like "section 4.3 on the next page"
% Must be loaded before hyperref.
\usepackage{varioref}
% Warnings rather than errors when references cross page boundaries.
\vrefwarning{}
% Errors when loops are encountered
\vrefshowerrors{}
% Shorten the text used for references with page numbers.
\renewcommand{\reftextfaraway}[1]{%
    [p.~\pageref{#1}]%
}
% Replacement for \ref{}, adds the page number too.
\newcommand{\refwithpage}[1]{%
    \empty{}\vref{#1}%
    %\empty{}\ref{#1} [p.~\pageref{#1}]%
}
% section references, automatically add \textsection
\newcommand{\sectionref}[1]{%
    \textsection{}\vref*{#1}%
    %\textsection{}\refwithpage{#1}%
}
% A reference with a space between the label and the reference.
\newcommand{\refwithlabel}[2]{%
    #1~\vref{#2}%
}
% table references, for consistent formatting.
\newcommand{\tableref}[1]{%
    \refwithlabel{table}{#1}%
}
\newcommand{\Tableref}[1]{%
    \refwithlabel{Table}{#1}%
}
% graph references
% SHOULD THESE BE LABELLED WITH graph OR figure?
\newcommand{\graphref}[1]{%
    \refwithlabel{graph}{#1}%
}
\newcommand{\Graphref}[1]{%
    \refwithlabel{Graph}{#1}%
}
% figure references
\newcommand{\figureref}[1]{%
    \refwithlabel{figure}{#1}%
}
\newcommand{\Figureref}[1]{%
    \refwithlabel{Figure}{#1}%
}


% Acronyms and glossary entries.  Useful options:
% * nonumberlist disables the list of page numbers after each entry.
\usepackage[acronym,toc,numberedsection=autolabel,style=list,nonumberlist]{glossaries}
\renewcommand{\glspostdescription}[0]{}
\renewcommand{\glsautoprefix}[1]{glossary:#1}
\newglossary[plg]{postfix}{pin}{pout}{Postfix Daemons}
\makeglossaries{}
\newcommand{\acronym}[1]{%
    \gls{#1}\glsadd{#1 glossary}%
}

% Provides commands to distinguish between pdf and dvi output.
\usepackage{ifpdf}
% When creating a \PDF{} make the table of contents into links to the pages
% (without horrible red borders) and include bookmarks.  The title and
% author do not work - I think either gnuplot or graphviz clobbers it.
% hyperfootnotes need to be disabled to avoid breaking footmisc, but they
% still seem to work, somehow.
\ifpdf{}
    \usepackage[pdftex,hyperfootnotes=false,plainpages=false,pdfpagelabels]{hyperref}
\else{}
    \usepackage[dvips,hyperfootnotes=false,plainpages=false,pdfpagelabels]{hyperref}
    % This is necessary for wrapping URLs in the bibliography when
    % producing a dvi, but causes problems when generating \PDF{} output.
    \usepackage{breakurl}
\fi{}
\hypersetup{
    pdftitle    = {Parsing Postfix log files},
    pdfauthor   = {John Tobin},
    final       = true,
    pdfborder   = {0 0 0},
}

%\setlength{\floatsep}{0pt}
%\setlength{\intextsep}{0pt}
%\setlength{\textfloatsep}{0pt}

% Show the citation key (e.g. slct-paper) in the margin beside the
% reference.
%\usepackage[nomsgs]{refcheck}
% Show where references are used.
% Neither work.
%\usepackage{citeref}
%\usepackage{backref}
%\renewcommand{\refname}{Bibliography}
% Put each URL in the bibliography on a new line.
\newcommand{\urlprefix}[0]{\newline{}}
% New formatting commands.

% \showgraph{filename}{caption}{label}
\newcommand{\showgraph}[3]{%
    \begin{figure}[hbt!]
        \caption{#2}\label{#3}
        \includegraphics{#1}
    \end{figure}
}

%\showtable{filename}{caption}{label}
\newcommand{\showtable}[3]{
    \begin{table}[ht]
        \caption{#2}\label{#3}
        \input{#1}
    \end{table}
}

\newcommand{\tabletopline}[0]{%
    \hline%
    \noalign{\smallskip}%
}

\newcommand{\tablebottomline}[0]{%
    \noalign{\smallskip}%
    \hline%
}

\newcommand{\tablemiddleline}[0]{%
    \noalign{\smallskip}%
    \hline%
    \noalign{\smallskip}%
}

% A command to format a Postfix daemon's name
\newcommand{\daemon}[1]{%
    \texttt{postfix/#1}%
}

\newcommand{\tab}[0]{%
    \hspace*{2em}%
}

% Constant values.
\newcommand{\numberOFlogFILES}[0]{%
    93%
}

\newcommand{\numberOFlogFILESall}[0]{%
    522%
}

\newcommand{\numberOFrules}[0]{%
    169%
}

\newcommand{\numberOFrulesMINIMUM}[0]{%
    115%
}

% \numberOFrulesMINIMUM as percentage of \numberOFrules
\newcommand{\numberOFrulesMINIMUMpercentage}[0]{%
    68.04\%%
}

% \numberOFrules as percentage increase of \numberOFrulesMINIMUM
\newcommand{\numberOFrulesMAXIMUMpercentage}[0]{%
    46.95\%%
}

\newcommand{\numberOFlogLINES}[0]{%
    60,721,709%
}

\newcommand{\numberOFlogLINEShuman}[0]{%
    60.72 million%
}

% The name of the program, so I only have to change it in one place.
\newcommand{\parsername}{\acronym{PLP}}
\newcommand{\parsernames}{\acronym{PLP}'s}

\begin{document}

\title{Parsing Postfix log files}
\author{John Tobin \\ School of Computer Science and Statistics \\
Trinity College \\ Dublin 2 \\ Ireland \\ tobinjt@cs.tcd.ie}
\maketitle

\begin{abstract}

    \phantomsection{}
    \addcontentsline{toc}{chapter}{Abstract}

    Parsing Postfix log files is much more difficult than it first appears,
    but it \textit{is\/} possible to achieve a high degree of accuracy in
    understanding the log files, and thus accuracy in reconstructing the
    actions taken by Postfix to generate the log files.  This paper
    describes the creation of a parser for Postfix log files, documenting
    the architecture developed and the parser implementing it, explaining
    the difficulties encountered and the solutions developed, with
    reference to an implementation that stores data gleaned from the log
    files in an SQL database.  The gathered data can then be used to
    optimise current anti-spam measures, provide a baseline to test new
    anti-spam measures against, or to produce statistics showing how
    effective those measures are.

\end{abstract}

\SVN$Id$
\begin{center}
    \SVNId{}
\end{center}

XXX WHY DOES \\ref{} NOT WORK PROPERLY FOR CHAPTERS IN THE APPENDIX\@?

XXX NEED A NAME FOR THE ARCHITECTURE, AND A DIFFERENT NAME FOR THE
IMPLEMENTATION\@.  Parse::FAR\@???

XXX CHECK ALL ``UNINTERESTING'' RULES TO SEE IF THEY COULD BE USED\@.

XXX CHECK YEARS FOR BIBLIOGRAPHY ENTRIES\@.  WHAT DO I MEAN BY THIS\@?

XXX IMPROVE BIBLIOGRAPHY APPEARANCE\@: NAMES LOOK UGLY (E.G.\ P.\
\empty{}.\ Porters)\@.

XXX CHECK WITH CARL ABOUT CAPITALISATION IN SECTION AND SUBSECTION
HEADINGS\@.

XXX MAYBE DO SOMETHING ABOUT underfull hboxes IN BIBLIOGRAPHY WHEN URLS
WRAP\@?

XXX INVESTIGATE Doug Lenat.

XXX EXTRACT DELAY AND DEFER WHEN AUTOMATIC EXTRACTION HAS BEEN FINISHED,
THEN UPDATE FIELDS IN BOTH DATABASE AND REVIEW OF OTHER PARSERS\@.

XXX POSSIBLY PUBLISH THE STATE OF THE ART REVIEW IN A JOURNAL\@?

\newpage
\tableofcontents
\listoffigures
\listoftables

\newpage

% Pull in the acronyms early, so they can be used throughout the text.
\input{logparser-acronyms}
\input{logparser-glossary}
\input{logparser-postfix-daemons}
\glsaddall[types={postfix}]

% WSUIPA fonts.
\input{ipamacs}

\input{logparser-introduction}
\input{logparser-background}
\input{logparser-other-parsers-review}
\input{logparser-architecture}
\input{logparser-implementation}
\input{logparser-results}
\input{logparser-conclusion}

\appendix

\bibliographystyle{logparser-bibliography-style}
\bibliography{logparser-bibliography}

\label{Glossary}
\printglossary{}
\label{Acronyms}
\printglossary[type=\acronymtype]{}
\label{Postfix Daemons}
\printglossary[type=postfix]{}

\end{document}
