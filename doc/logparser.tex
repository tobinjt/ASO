% $Id$
\documentclass[a4paper,12pt,draft]{article}

% Useful stuff for math mode.
\usepackage{amstext}
% Include images
\usepackage[final]{graphicx}
% Add the bibliography into the table of contents.
\usepackage[section,numbib]{tocbibind}
% Create a label for the last page.  Might be useful for "page 23/79" or
% something.
\usepackage{lastpage}

% Extra packages recommended by Springer: they change the fonts from
% Computer Modern to something else and tells Latex to use scalable fonts.
\usepackage{type1cm}
%\usepackage{mathptmx}
%\usepackage{helvet}
%\usepackage{courier}
% Extra footnote functionality, including references to earlier footnotes.
\usepackage{footmisc}

% Sort numbers where there are multiple citations.  does not appear to have
% any effect (probably clashes with varioref or hyperref), though it does
% reduce the space between numbers.
\usepackage{cite}

% Acronyms and glossary entries.
% global=true prevents acronyms being expanded twice
\usepackage[global=true,acronym=true,style=altlist,number=none,toc=true]{glossary}
\makeglossary{}
\makeacronym{}

% Produce nicer references like "section 4.3 on the next page"
% Must be loaded before hyperref.
\usepackage{varioref}
% Warnings rather than errors when references cross page boundaries.
\vrefwarning{}
% Errors when loops are encountered
\vrefshowerrors{}
% Shorten the text used for references with page numbers.
\renewcommand{\reftextfaraway}[1]{%
    [p.~\pageref{#1}]%
}
% Replacement for \ref{}, adds the page number too.
\newcommand{\refwithpage}[1]{%
    \empty{}\vref{#1}%
    %\empty{}\ref{#1} [p.~\pageref{#1}]%
}
% section references, automatically add \textsection
\newcommand{\sectionref}[1]{%
    \textsection{}\vref*{#1}%
    %\textsection{}\refwithpage{#1}%
}
% A reference with a space between the label and the reference.
\newcommand{\refwithlabel}[2]{%
    #1~\vref{#2}%
}
% table references, for consistent formatting.
\newcommand{\tableref}[1]{%
    \refwithlabel{table}{#1}%
}
\newcommand{\Tableref}[1]{%
    \refwithlabel{Table}{#1}%
}
% graph references
\newcommand{\graphref}[1]{%
    \refwithlabel{graph}{#1}%
}
\newcommand{\Graphref}[1]{%
    \refwithlabel{Graph}{#1}%
}
% figure references
\newcommand{\figureref}[1]{%
    \refwithlabel{figure}{#1}%
}
\newcommand{\Figureref}[1]{%
    \refwithlabel{Figure}{#1}%
}


% Provides commands to distinguish between pdf and dvi output.
\usepackage{ifpdf}
% When creating a \PDF{} make the table of contents into links to the pages
% (without horrible red borders) and include bookmarks.  The title and
% author do not work - I think either gnuplot or graphviz clobbers it.
% hyperfootnotes need to be disabled to avoid breaking footmisc, but they
% still seem to work, somehow.
\ifpdf{}
    \usepackage[pdftex,hyperfootnotes=false]{hyperref}
\else{}
    \usepackage[dvips,hyperfootnotes=false]{hyperref}
    % This is necessary for wrapping URLs in the bibliography when
    % producing a dvi, but causes problems when generating \PDF{} output.
    \usepackage{breakurl}
\fi{}
\hypersetup{
    pdftitle    = {Parsing Postfix log files},
    pdfauthor   = {John Tobin},
    final       = true,
    pdfborder   = {0 0 0},
}



\renewcommand{\refname}{Bibliography}
% New formatting commands.

% \showgraph{filename}{caption}{label}
\newcommand{\showgraph}[3]{
    \begin{figure}[hbt!]
        \caption{#2}\label{#3}
        \includegraphics{#1}
    \end{figure}
}

%\showtable{filename}{caption}{label}
\newcommand{\showtable}[3]{
    \begin{table}[ht]
        \caption{#2}\label{#3}
        \input{#1}
    \end{table}
}

% A command to format a Postfix daemon's name
\newcommand{\daemon}[1]{%
    \texttt{postfix/#1}%
}

% This is ridiculous, but I cannot put @ in glossary entries, so . . .
\newcommand{\at}[0]{%
    @%
}
% This is ridiculous, but I cannot put @ in glossary entries, so . . .
\newcommand{\backslashat}[0]{%
    \@%
}

\newcommand{\tab}[0]{%
    \hspace*{2em}%
}

% Constant values.
\newcommand{\numberOFlogFILES}[0]{%
    93%
}

\newcommand{\numberOFrules}[0]{%
    169%
}

\newcommand{\numberOFlogLINES}[0]{%
    60,721,709%
}

\newcommand{\numberOFlogLINEShuman}[0]{%
    60.72 million%
}

% The name of the program, so I only have to change it in one place.
\newcommand{\parsername}{\PLP{}}
\newcommand{\parsernames}{\PLP{}'s}

% This keeps hyperref fairly happy about the Abstract entry in the table of
% contents.
\newcounter{dummy}

\begin{document}

% Pull in the acronyms early, so they can be used throughout the text.
\input{logparser-acronyms.tex}

\title{Parsing Postfix log files}
\author{John Tobin \\ School of Computer Science and Statistics \\
Trinity College \\ Dublin 2 \\ Ireland \\ tobinjt@cs.tcd.ie}
\maketitle

\refstepcounter{dummy}
\addcontentsline{toc}{section}{Abstract}
\begin{abstract}

    Parsing Postfix log files is much more difficult than it first appears,
    but it \textit{is\/} possible to achieve a high degree of accuracy in
    understanding the log files, and thus accuracy in reconstructing the
    actions taken by Postfix to generate the log files.  This paper
    describes the creation of a parser, documenting the parsing algorithm,
    explaining the difficulties encountered and the solutions developed,
    with reference to an implementation which stores data gleaned from the
    log files in an SQL database.  The gathered data can then be used to
    optimise current anti-spam measures, provide a baseline to test new
    anti-spam measures against, or to produce statistics showing how
    effective those measures are.

\end{abstract}

XXX WEKA FOR DECISION TREE DISPLAY\@.

XXX CHECK Y-AXIS LABELS ON GRAPHS TO ENSURE THEY CAN BE READ, AND WRAP IF
NECESSARY\@.

XXX EXPLAIN THE X-AXIS ON GRAPHS --- MADS THOUGHT IT WAS UNCLEAR\@.

XXX ``.'' AFTER ETC\@; SHOULD I HAVE A BACKSLASH AFTER THE ``.''?

\newpage

XXX NEW LAYOUT\@:

\begin{verbatim}
Introduction
Background
State of the Art Review
Parser Architecture
Postfix Parser Implementation
    Database Schema
    Rules
    Actions
    Complications
Results - BETTER TITLE?
    Coverage
    Efficiency
    Limitations and Improvements
Conclusion
References
Glossary
Acronyms
\end{verbatim}

\newpage
\tableofcontents
\listoffigures
\listoftables

\newpage
\input{logparser-introduction.tex}
\input{logparser-background.tex}
\input{logparser-database-schema.tex}
\input{logparser-parsing-rules.tex}
\input{logparser-parsing-algorithm.tex}
\input{logparser-coverage.tex}
\input{logparser-limitations.tex}
\input{logparser-conclusion.tex}

\appendix

\input{logparser-other-parsers-review.tex}

\bibliographystyle{logparser-bibliography-style}
\bibliography{logparser-bibliography}
\label{bibliography}

\input{logparser-graphs.tex}

% Redefine the command used to produce the glossary title, because the
% default command produces an unnumbered section whereas I want a numbered
% section.
\renewcommand{\glossarytitle}{\section{Glossary}\label{Glossary}}
\printglossary{}
% Redefine the command a second time to produce acronyms instead of a
% glossary.
\renewcommand{\glossarytitle}{\section{Acronyms}\label{Acronyms}}
\printacronym{}

\input{logparser-glossary.tex}
% logparser-acronyms.tex has been included in the preamble so that the
% commands are available throughout the text.
\end{document}
